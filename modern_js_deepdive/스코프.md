# 📚 스코프

> 모든 식별자 (변수 이름, 함수 이름, 클래스 이름 등)는 `자신이 선언된 위치`에 의해 다른 코드가 식별자 자신을 참조할 수 있는 유효 범위가 결정된다. _**이를 스코프라 한다.**_ 즉, 스코프는 `식별자가 유효한 범위`를 말한다.

## 식별자 결정

### 💡 식별자 결정이란 ?

🗣️ 자바스크립트 엔진이 스코프를 통해 `어떤 식별자를 참조해야 할 것인지 결정`하는 것

- 따라서 스코프란 자바스크립트 엔진이 식별자를 검색할 때 사용하는 규칙이라고도 할 수 있다
- 만약 스코프라는 개념이 없다면
  같은 이름을 갖는 변수는 충돌을 일으키므로 프로그램 전체에서 하나밖에 사용할 수 없다
- **식별자는 어떤 값을 구별할 수 있어야 하므로 유일해야 한다.**

> 프로그래밍 언어에서는 스코프(유효 범위)를 통해 충돌을 방지하여 같은 이름의 변수를 사용할 수 있게 한다. 스코프 내에서 식별자는 유일해야 하지만 다른 스코프에는 같은 이름의 식별자를 사용할 수 있다. **즉, 스코프는 네임스페이스다.**

---

# 스코프의 종류

- 변수는 자신이 선언된 위치에 의해 스코프가 결정된다
- 즉, 전역에서 선언된 변수는 전역 스코프를 갖는 전역 변수이고,
  지역에서 선언된 변수는 지역 스코프를 갖는 지역 변수다
- **전역 변수는 어디서든지 참조할 수 있다.**

### 지역 스코프

- 지역이란 `함수 몸체 내부`를 말한다
- 지역 변수는 자신이 선언된 지역과 하위 지역(중첩 함수)에서만 참조할 수 있다
- 다시 말해, 지역 변수는 자신의 지역 스코프와 하위 지역 스코프에서 유효하다.

---

# 스코프 체인

- 함수는 중첩될 수 있으므로 함수의 지역 스코프도 중첩될 수 있다.
- 이는 스코프가 함수의 중첩에 의해 계층적 구조를 갖는다는 것을 의미한다.
- 이때 외부 함수의 지역 스코프를 중첩 함수의 `상위 스코프`라 한다.

> 💡 **모든 스코프는 하나의 계층적 구조로 연결되며, 모든 지역 스코프의 최상위 스코프는 전역 스코프이다**

### 이렇게 스코프가 계층적으로 연결된 것을 *스코프 체인*이라 한다.

- 변수를 참조할 때 자바스크립트 엔진은 스코프 체인을 통해 변수를 참조하는 코드의 스코프에서 시작하여 `상위 스코프 방향으로 이동하며 선언된 변수를 검색한다`
- - _**절대 하위 스코프로 내려가면서 식별자를 검색하는 일은 없다**_
    이는 상위 스코프에서 유효한 변수는 하위 스코프에서 자유롭게 참조할 수 있지만,
    하위 스코프에서 유효한 변수를 상위 스코프에서 참조할 수 없다는 것을 의미한다
- 스코프 체인은 물리적인 실체로 존재한다
- 자바스크립트 엔진은 코드를 실행하기에 앞서(런타임) 렉시컬 환경(자료구조) 을 실제로 생성한다.

## 렉시컬 환경

스코프 체인은 `실행 컨텍스트의 렉시컬 환경을 단방향으로 연결`한 것이다.
`전역 렉시컬 환경`은 **코드가 로드**되면 곧바로 생성되고, `함수의 렉시컬 환경`은 **함수가 호출**되면 곧바로 생성된다.

# 함수 레벨 스코프

- 지역은 함수 몸체 내부를 말한다고 했다
- 이는 코드 블록이 아닌 함수에 의해서만 지역 스코프가 생성된다는 의미다
- 대부분의 프로그래밍 언어는 함수 몸체만이 아니라 모든 코드 블록이 지역 스코프를 만든다. ⇒ `블록 레벨 스코프`
- 하지만 `var` 키워드로 선언된 변수는 오로지 함수의 코드 블록(함수 몸체)만을 지역 스코프로 인정한다. ⇒ `함수 레벨 스코프`

### `let, const` 키워드는 블록 레벨 스코프를 지원한다.

---

# 렉시컬 스코프

- `동적 스코프` : 함수를 정의하는 시점에는 함수가 어디서 호출될 지 알 수 없다
  따라서 `함수가 호출되는 시점`에 동적으로 상위 스코프를 결정해야 하기 때문에 동적 스코프라 부른다
- `정적 스코프 / 렉시컬 스코프` : **함수 정의가 평가되는 시점에 상위 스코프가 정적으로 결정된다.** 자바스크립트를 비롯한 대부분의 프로그래밍 언어는 렉시컬 스코프를 따른다.

> 자바스크립트는 렉시컬 스코프를 따르므로 함수를 어디서 호출했는지가 아니라 **함수를 어디서 정의**했는지에 따라 상위 스코프를 결정한다
> 함수가 호출된 위치는 상위 스코프 결정에 어떠한 영향도 주지 않는다
> 즉, `함수의 상위 스코프는 언제나 자신이 정의된 스코프다.`
